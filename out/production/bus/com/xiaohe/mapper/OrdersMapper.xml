<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xiaohe.mapper.OrdersMapper" >
<!-- 登陆查询验证用户名密码 -->
<select id="queryBusList" resultType="BusList">
	select bus.*,bus_address.* from bus,bus_address where bus_address.address_id = bus.bus_address_id;
</select>

<update id="changeOrder" parameterType="ChangeSigin">
        update orders set bus_id = #{bus_id}, order_state = "1" where order_id = #{order_id}
 </update>
 
<select id="getBusTimes" parameterType="int" resultType="Bus">
	select * from bus where  bus.bus_address_id = #{bus_address_id}   order by bus.bus_times asc
</select>

<select id="queryBusItemInfor" parameterType="BusItemId" resultType="BusList">
	select bus.*,bus_address.*
	 from bus,bus_address 
	 where 
	 bus.bus_id = #{bus_id}
	 and bus.bus_address_id = #{bus_address_id}
	 and bus_address.address_id = bus.bus_address_id;
</select>
<select id="getOrder" parameterType="int" resultType="BusList">
	select bus.*,bus_address.*,orders.*
	 from bus,bus_address,orders
	 where 
	 orders.user_id = #{user_id}
	 and bus.bus_id = orders.bus_id
	 and bus_address.address_id = bus.bus_address_id
	 and bus_address.address_id = bus.bus_address_id
	 and orders.order_state = "0";
</select>
<select id="getOrderAll" parameterType="int" resultType="BusList">
	select bus.*,bus_address.*,orders.*
	 from bus,bus_address,orders
	 where 
	 orders.user_id = #{user_id}
	 and bus.bus_id = orders.bus_id
	 and bus_address.address_id = bus.bus_address_id
	 and bus_address.address_id = bus.bus_address_id;
	 
</select>

<select id="search" parameterType="Search" resultType="BusList">
	select bus.*,bus_address.* from bus,bus_address where
	 bus_address.address_id = bus.bus_address_id
	 and bus_address.start_address = #{start_address}
	 and bus_address.end_address = #{end_address};
	 
</select>
<select id="getMoney" parameterType="int" resultType="int">
	select order_price from orders  where orders.order_id = #{order_id}; 
	 
</select>

<insert id="addOrder" parameterType="Orders">
	insert into orders (orders.user_id,orders.bus_id, orders.order_count,orders.order_state,orders.order_price,orders.order_date) 
	value (#{user_id},#{bus_id},#{order_count},"0",#{order_price},#{order_date})
	<selectKey keyProperty="order_price" order="AFTER" resultType="int">
		SELECT LAST_INSERT_ID()
	</selectKey>
</insert>

<delete id="deleteOrder" parameterType="int">
	 delete from orders where orders.order_id = #{order_id}
</delete>
</mapper>